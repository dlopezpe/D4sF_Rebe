{"version":3,"file":"geojson.js","sources":["src/ol-ext/geojson.js"],"sourcesContent":["import { EPSG_3857, EPSG_4326 } from './consts'\nimport Feature from 'ol/Feature'\nimport { get, isPlainObject } from '../util/minilo'\nimport { createGeoJsonFmt } from './format'\n\nconst geoJsonFmt = createGeoJsonFmt()\n\n/**\n * @param {Feature} feature\n * @param {ProjectionLike|undefined} [featureProjection=EPSG:3857]\n * @param {ProjectionLike|undefined} [dataProjection=EPSG:4326]\n * @return {Object}\n */\nexport function writeGeoJsonFeature (feature, featureProjection = EPSG_3857, dataProjection = EPSG_4326) {\n  const geoJsonFeature = geoJsonFmt.writeFeatureObject(feature, { featureProjection, dataProjection })\n\n  if (Array.isArray(get(geoJsonFeature, 'properties.features'))) {\n    geoJsonFeature.properties.features = geoJsonFeature.properties.features.map(feature => {\n      if (feature instanceof Feature) {\n        return writeGeoJsonFeature(feature, featureProjection, dataProjection)\n      }\n      return feature\n    })\n  }\n\n  return geoJsonFeature\n}\n\n/**\n * @param {Object} geoJsonFeature\n * @param {ProjectionLike|undefined} [featureProjection=EPSG:3857]\n * @param {ProjectionLike|undefined} [dataProjection=EPSG:4326]\n * @return {Feature}\n */\nexport function readGeoJsonFeature (geoJsonFeature, featureProjection = EPSG_3857, dataProjection = EPSG_4326) {\n  let feature = geoJsonFmt.readFeature(geoJsonFeature, { featureProjection, dataProjection })\n\n  if (Array.isArray(feature.get('features'))) {\n    feature.set('features', feature.get('features').map(feature => {\n      if (isPlainObject(feature)) {\n        return readGeoJsonFeature(feature, featureProjection, dataProjection)\n      }\n      return feature\n    }))\n  }\n\n  return feature\n}\n\n/**\n * @param {Geometry} geometry\n * @param {ProjectionLike|undefined} [geometryProjection=EPSG:3857]\n * @param {ProjectionLike|undefined} [dataProjection=EPSG:4326]\n * @return {Object}\n */\nexport function writeGeoJsonGeometry (geometry, geometryProjection = EPSG_3857, dataProjection = EPSG_4326) {\n  return geoJsonFmt.writeGeometryObject(geometry, {\n    featureProjection: geometryProjection,\n    dataProjection,\n  })\n}\n\n/**\n * @param {Object|Object} geoJsonGeometry\n * @param {ProjectionLike|undefined} [geometryProjection=EPSG:3857]\n * @param {ProjectionLike|undefined} [dataProjection=EPSG:4326]\n * @return {Geometry}\n */\nexport function readGeoJsonGeometry (geoJsonGeometry, geometryProjection = EPSG_3857, dataProjection = EPSG_4326) {\n  dataProjection = readProjection(geoJsonGeometry, dataProjection)\n\n  return geoJsonFmt.readGeometry(geoJsonGeometry, {\n    featureProjection: geometryProjection,\n    dataProjection,\n  })\n}\n\nexport function readProjection (geoJsonObj, defaultProjection) {\n  return geoJsonFmt.readProjection(geoJsonObj) || defaultProjection\n}\n"],"names":["geoJsonFmt","createGeoJsonFmt","writeGeoJsonFeature","feature","featureProjection","EPSG_3857","dataProjection","EPSG_4326","geoJsonFeature","writeFeatureObject","Array","isArray","get","properties","features","Feature","readGeoJsonFeature","readFeature","set","isPlainObject","writeGeoJsonGeometry","geometry","geometryProjection","writeGeometryObject","readGeoJsonGeometry","geoJsonGeometry","readProjection","readGeometry","geoJsonObj","defaultProjection"],"mappings":";;;;;;;;;;;;;;;;AAKA,IAAMA,UAAU,GAAGC,gBAAgB,EAAnC;;;;;;;;AAQA,AAAO,SAASC,mBAAT,CAA8BC,OAA9B,EAAkG;MAA3DC,iBAA2D,uEAAvCC,SAAuC;MAA5BC,cAA4B,uEAAXC,SAAW;MACjGC,cAAc,GAAGR,UAAU,CAACS,kBAAX,CAA8BN,OAA9B,EAAuC;IAAEC,iBAAiB,EAAjBA,iBAAF;IAAqBE,cAAc,EAAdA;GAA5D,CAAvB;;MAEII,KAAK,CAACC,OAAN,CAAcC,GAAG,CAACJ,cAAD,EAAiB,qBAAjB,CAAjB,CAAJ,EAA+D;;;IAC7DA,cAAc,CAACK,UAAf,CAA0BC,QAA1B,GAAqC,gCAAAN,cAAc,CAACK,UAAf,CAA0BC,QAA1B,iBAAuC,UAAAX,OAAO,EAAI;UACjFA,OAAO,YAAYY,OAAvB,EAAgC;eACvBb,mBAAmB,CAACC,OAAD,EAAUC,iBAAV,EAA6BE,cAA7B,CAA1B;;;aAEKH,OAAP;KAJmC,CAArC;;;SAQKK,cAAP;;;;;;;;;AASF,AAAO,SAASQ,kBAAT,CAA6BR,cAA7B,EAAwG;MAA3DJ,iBAA2D,uEAAvCC,SAAuC;MAA5BC,cAA4B,uEAAXC,SAAW;MACzGJ,OAAO,GAAGH,UAAU,CAACiB,WAAX,CAAuBT,cAAvB,EAAuC;IAAEJ,iBAAiB,EAAjBA,iBAAF;IAAqBE,cAAc,EAAdA;GAA5D,CAAd;;MAEII,KAAK,CAACC,OAAN,CAAcR,OAAO,CAACS,GAAR,CAAY,UAAZ,CAAd,CAAJ,EAA4C;;;IAC1CT,OAAO,CAACe,GAAR,CAAY,UAAZ,EAAwB,iCAAAf,OAAO,CAACS,GAAR,CAAY,UAAZ,mBAA4B,UAAAT,OAAO,EAAI;UACzDgB,aAAa,CAAChB,OAAD,CAAjB,EAA4B;eACnBa,kBAAkB,CAACb,OAAD,EAAUC,iBAAV,EAA6BE,cAA7B,CAAzB;;;aAEKH,OAAP;KAJsB,CAAxB;;;SAQKA,OAAP;;;;;;;;;AASF,AAAO,SAASiB,oBAAT,CAA+BC,QAA/B,EAAqG;MAA5DC,kBAA4D,uEAAvCjB,SAAuC;MAA5BC,cAA4B,uEAAXC,SAAW;SACnGP,UAAU,CAACuB,mBAAX,CAA+BF,QAA/B,EAAyC;IAC9CjB,iBAAiB,EAAEkB,kBAD2B;IAE9ChB,cAAc,EAAdA;GAFK,CAAP;;;;;;;;;AAYF,AAAO,SAASkB,mBAAT,CAA8BC,eAA9B,EAA2G;MAA5DH,kBAA4D,uEAAvCjB,SAAuC;MAA5BC,cAA4B,uEAAXC,SAAW;EAChHD,cAAc,GAAGoB,cAAc,CAACD,eAAD,EAAkBnB,cAAlB,CAA/B;SAEON,UAAU,CAAC2B,YAAX,CAAwBF,eAAxB,EAAyC;IAC9CrB,iBAAiB,EAAEkB,kBAD2B;IAE9ChB,cAAc,EAAdA;GAFK,CAAP;;AAMF,AAAO,SAASoB,cAAT,CAAyBE,UAAzB,EAAqCC,iBAArC,EAAwD;SACtD7B,UAAU,CAAC0B,cAAX,CAA0BE,UAA1B,KAAyCC,iBAAhD;;;;;"}