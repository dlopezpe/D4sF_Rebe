{"version":3,"file":"identity-map.js","sources":["src/util/identity-map.js"],"sourcesContent":["/**\n * Simple Identity map with refs count\n */\nexport default class IdentityMap {\n  _pools = Object.create(null)\n\n  /**\n   * @param {string} pool\n   * @private\n   */\n  _preparePool (pool) {\n    this._pools[pool] || (this._pools[pool] = Object.create(null))\n  }\n\n  /**\n   * @param {string} id\n   * @param {*} value\n   * @param {string} pool\n   */\n  set (id, value, pool = 'default') {\n    if (value == null) return\n\n    this._preparePool(pool)\n\n    this._pools[pool][id] = {\n      value,\n      refs: 1,\n    }\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   */\n  get (id, pool = 'default') {\n    this._preparePool(pool)\n\n    let rec = this._pools[pool][id]\n    if (!rec || rec.value == null) return\n\n    rec.refs++\n    this._pools[pool][id] = rec\n\n    return rec.value\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   */\n  unset (id, pool = 'default') {\n    this._preparePool(pool)\n\n    let rec = this._pools[pool][id]\n    if (!rec || rec.value == null) return\n\n    rec.refs--\n    if (rec.refs === 0) {\n      delete this._pools[pool][id]\n    }\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   * @return {boolean}\n   */\n  has (id, pool = 'default') {\n    this._preparePool(pool)\n\n    return !!this._pools[pool][id]\n  }\n\n  /**\n   * @param {string} pool\n   * @return {string[]}\n   */\n  ids (pool = 'default') {\n    this._preparePool(pool)\n\n    return Object.keys(this._pools[pool])\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   * @return {*}\n   */\n  refs (id, pool = 'default') {\n    this._preparePool(pool)\n\n    return this.has(id, pool) ? this._pools[pool][id].refs : undefined\n  }\n}\n"],"names":["IdentityMap","Object","create","pool","_pools","id","value","_preparePool","refs","rec","has","undefined"],"mappings":";;;;;;;;;;;;;;;AAAA;;;IAGqBA;;;;oCACVC,MAAM,CAACC,MAAP,CAAc,IAAd;;;;;;;;;;0BAMKC,IAAd,EAAoB;WACbC,MAAL,CAAYD,IAAZ,MAAsB,KAAKC,MAAL,CAAYD,IAAZ,IAAoBF,MAAM,CAACC,MAAP,CAAc,IAAd,CAA1C;;;;;;;;;;WAQF,aAAKG,EAAL,EAASC,KAAT,EAAkC;UAAlBH,IAAkB,uEAAX,SAAW;UAC5BG,KAAK,IAAI,IAAb,EAAmB;;WAEdC,YAAL,CAAkBJ,IAAlB;;WAEKC,MAAL,CAAYD,IAAZ,EAAkBE,EAAlB,IAAwB;QACtBC,KAAK,EAALA,KADsB;QAEtBE,IAAI,EAAE;OAFR;;;;;;;;;WAUF,aAAKH,EAAL,EAA2B;UAAlBF,IAAkB,uEAAX,SAAW;;WACpBI,YAAL,CAAkBJ,IAAlB;;UAEIM,GAAG,GAAG,KAAKL,MAAL,CAAYD,IAAZ,EAAkBE,EAAlB,CAAV;UACI,CAACI,GAAD,IAAQA,GAAG,CAACH,KAAJ,IAAa,IAAzB,EAA+B;MAE/BG,GAAG,CAACD,IAAJ;WACKJ,MAAL,CAAYD,IAAZ,EAAkBE,EAAlB,IAAwBI,GAAxB;aAEOA,GAAG,CAACH,KAAX;;;;;;;;;WAOF,eAAOD,EAAP,EAA6B;UAAlBF,IAAkB,uEAAX,SAAW;;WACtBI,YAAL,CAAkBJ,IAAlB;;UAEIM,GAAG,GAAG,KAAKL,MAAL,CAAYD,IAAZ,EAAkBE,EAAlB,CAAV;UACI,CAACI,GAAD,IAAQA,GAAG,CAACH,KAAJ,IAAa,IAAzB,EAA+B;MAE/BG,GAAG,CAACD,IAAJ;;UACIC,GAAG,CAACD,IAAJ,KAAa,CAAjB,EAAoB;eACX,KAAKJ,MAAL,CAAYD,IAAZ,EAAkBE,EAAlB,CAAP;;;;;;;;;;;WASJ,aAAKA,EAAL,EAA2B;UAAlBF,IAAkB,uEAAX,SAAW;;WACpBI,YAAL,CAAkBJ,IAAlB;;aAEO,CAAC,CAAC,KAAKC,MAAL,CAAYD,IAAZ,EAAkBE,EAAlB,CAAT;;;;;;;;;WAOF,eAAuB;UAAlBF,IAAkB,uEAAX,SAAW;;WAChBI,YAAL,CAAkBJ,IAAlB;;aAEO,aAAY,KAAKC,MAAL,CAAYD,IAAZ,CAAZ,CAAP;;;;;;;;;;WAQF,cAAME,EAAN,EAA4B;UAAlBF,IAAkB,uEAAX,SAAW;;WACrBI,YAAL,CAAkBJ,IAAlB;;aAEO,KAAKO,GAAL,CAASL,EAAT,EAAaF,IAAb,IAAqB,KAAKC,MAAL,CAAYD,IAAZ,EAAkBE,EAAlB,EAAsBG,IAA3C,GAAkDG,SAAzD;;;;;;;;;"}